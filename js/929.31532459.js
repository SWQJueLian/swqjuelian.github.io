"use strict";(self["webpackChunkmyshop"]=self["webpackChunkmyshop"]||[]).push([[929],{9929:function(e,t,o){o.r(t),o.d(t,{default:function(){return v}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[t("van-nav-bar",{attrs:{title:"会员登录","left-arrow":""},on:{"click-left":function(t){return e.$router.go(-1)}}}),t("div",{staticClass:"container"},[e._m(0),t("van-form",[t("van-field",{attrs:{clearable:"",label:"手机号码",type:"tel",maxlength:"13",placeholder:"请输入手机号码",rules:[{validator:e.validatorMobile,message:""}]},model:{value:e.mobile,callback:function(t){e.mobile="string"===typeof t?t.trim():t},expression:"mobile"}}),t("van-field",{attrs:{center:"",clearable:"",maxlength:"4",label:"图形验证码",placeholder:"请输入图形验证码",rules:[{validator:e.validatorCode,message:""}]},scopedSlots:e._u([{key:"extra",fn:function(){return[e.codePic?t("img",{staticClass:"code",attrs:{src:e.codePic,alt:""},on:{click:function(t){return e.getCode()}}}):e._e()]},proxy:!0}]),model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),t("van-field",{attrs:{center:"",clearable:"",required:"",maxlength:"6",label:"短信验证码",placeholder:"请输入短信验证码",rules:[{validator:e.validatorSMSCode,message:""}]},scopedSlots:e._u([{key:"button",fn:function(){return[t("van-button",{attrs:{disabled:e.totalSecond!==e.currentSecond,size:"small",type:"primary"},on:{click:e.getSMSCode}},[e._v(" "+e._s(e.totalSecond===e.currentSecond?"获取验证码":`${e.currentSecond}秒后重新发送`)+" ")])]},proxy:!0}]),model:{value:e.smscode,callback:function(t){e.smscode=t},expression:"smscode"}})],1),t("div",{staticClass:"login-btn",on:{click:e.loginSystem}},[e._v("登录")]),t("p",{staticStyle:{"padding-top":"10px"}},[e._v(" 手机号建议用"+e._s(e.mobile)+"，因为后台数据已经设置好了。也可以随便填一个。 ")]),t("p",[e._v("测试环境短信验证码为：246810")])],1)],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("手机号登录")]),t("p",[e._v("未注册的手机号登录后将自动注册")])])}],i=o(4471);const r=()=>i.Z.get("/captcha/image"),l=(e,t,o)=>i.Z.post("/captcha/sendSmsCaptcha",{form:{captchaCode:e,captchaKey:t,mobile:o}}),c=(e,t)=>i.Z.post("/passport/login",{form:{isParty:!1,mobile:e,partyData:{},smsCode:t}});var n=o(3822),d={name:"LoginPage",created(){this.getCode()},beforeDestroy(){clearInterval(this.smstimer)},data(){return{codePic:"",codeKey:"",code:"",mobile:"13222222222",smstimer:null,totalSecond:5,currentSecond:5,smscode:""}},methods:{...(0,n.OI)("user",["updateUserInfo"]),async loginSystem(){if(!(this.validatorSMSCode(this.smscode)&&this.validatorCode(this.code)&&this.validatorMobile(this.mobile)))return void this.$toast("校验不通过！允许登录系统");const{data:e}=await c(this.mobile,this.smscode);this.$toast("登录成功！"),this.updateUserInfo(e);const t=this.$route.query.back;console.log("回跳url地址：",t),this.$router.replace(t||"/home")},validatorMobile(e){return console.log(e),/^[1,3-9]\d{10}$/.test(e)},validatorCode(e){return/^\w{4}$/.test(e)},validatorSMSCode(e){return/^\d{6}$/.test(e)},async getSMSCode(){this.validatorCode(this.code)&&this.validatorMobile(this.mobile)?this.smstimer||this.currentSecond!==this.totalSecond?console.log("频繁获取短信验证码"):(this.smstimer=setInterval((()=>{this.currentSecond--,this.currentSecond<=0&&(clearInterval(this.smstimer),this.smstimer=null,this.currentSecond=this.totalSecond)}),1e3),await l(this.code,this.codeKey,this.mobile),this.$toast("获取短信验证码成功！测试环境验证码为246810")):this.$toast("校验不通过！不发送短信验证码")},async getCode(){const{data:{base64:e,key:t}}=await r();this.codeKey=t,this.codePic=e}}},u=d,h=o(1001),m=(0,h.Z)(u,s,a,!1,null,"7744003e",null),v=m.exports}}]);
//# sourceMappingURL=929.31532459.js.map