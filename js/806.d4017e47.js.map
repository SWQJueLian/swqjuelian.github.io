{"version":3,"file":"js/806.d4017e47.js","mappings":"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","sources":["webpack://myshop/./src/views/order/product-comment-detail.vue","webpack://myshop/src/views/order/product-comment-detail.vue","webpack://myshop/./src/views/order/product-comment-detail.vue?4da4","webpack://myshop/./src/views/order/product-comment-detail.vue?ea37","webpack://myshop/./src/apis/product.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"comment-sku\"},[_c('van-nav-bar',{attrs:{\"title\":\"评价商品\",\"left-text\":\"返回\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('div',{staticClass:\"main\"},[_c('div',{staticClass:\"comment-sku-item\"},[_c('div',{staticClass:\"goods-info\"},[_c('div',{staticClass:\"goods-img\"},[_c('img',{attrs:{\"src\":_vm.detailGoods.goods_image,\"alt\":\"\"}})]),_c('div',{staticClass:\"goods-content\"},[_c('div',{staticClass:\"text-ellipsis-2\"},[_vm._v(\" \"+_vm._s(_vm.detailGoods.goods_name)+\" \")])])]),_c('div',{staticClass:\"rate\"},[_vm._v(\" 评分：\"),_c('van-rate',{model:{value:(_vm.rateNum),callback:function ($$v) {_vm.rateNum=$$v},expression:\"rateNum\"}})],1),_c('div',[_c('van-field',{attrs:{\"rows\":\"2\",\"autosize\":{maxHeight:100,minHeight:100},\"clearable\":\"\",\"type\":\"textarea\",\"maxlength\":\"500\",\"placeholder\":\"感觉怎样？跟大家分享一下吧~\",\"show-word-limit\":\"\"},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}})],1),_c('div',[_c('van-uploader',{attrs:{\"multiple\":\"\",\"max-count\":10,\"after-read\":_vm.afterRead,\"before-delete\":_vm.beforeDelete},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}})],1),_c('div',{staticClass:\"van-hairline--bottom\"}),_c('button',{on:{\"click\":_vm.handlerSubmitComment}},[_vm._v(\"提交评价\")])])])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"comment-sku\">\r\n    <van-nav-bar\r\n      title=\"评价商品\"\r\n      left-text=\"返回\"\r\n      left-arrow\r\n      @click-left=\"$router.back()\"\r\n    />\r\n    <div class=\"main\">\r\n      <div class=\"comment-sku-item\">\r\n        <!--商品信息-->\r\n        <div class=\"goods-info\">\r\n          <div class=\"goods-img\">\r\n            <img :src=\"detailGoods.goods_image\" alt=\"\">\r\n          </div>\r\n          <div class=\"goods-content\">\r\n            <div class=\"text-ellipsis-2\">\r\n              {{ detailGoods.goods_name }}\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n        <!--评分条-->\r\n        <div class=\"rate\">\r\n          评分：<van-rate v-model=\"rateNum\" />\r\n        </div>\r\n        <!--评价内容-->\r\n        <div>\r\n          <van-field\r\n            v-model=\"message\"\r\n            rows=\"2\"\r\n            :autosize=\"{maxHeight:100,minHeight:100}\"\r\n            clearable\r\n            type=\"textarea\"\r\n            maxlength=\"500\"\r\n            placeholder=\"感觉怎样？跟大家分享一下吧~\"\r\n            show-word-limit\r\n          />\r\n        </div>\r\n        <!--图片上传-->\r\n        <div>\r\n          <van-uploader\r\n            v-model=\"fileList\"\r\n            multiple :max-count=\"10\"\r\n            :after-read=\"afterRead\"\r\n            :before-delete=\"beforeDelete\"\r\n          />\r\n        </div>\r\n        <!--分割线-->\r\n        <div class=\"van-hairline--bottom\"></div>\r\n        <button @click=\"handlerSubmitComment\">提交评价</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { submitComment, uploadImage } from '@/apis/product'\r\nimport { mapGetters } from 'vuex'\r\nimport { Notify } from 'vant'\r\n\r\nexport default {\r\n  name: 'ProductCommentDetail',\r\n  created () {\r\n    Notify('因为api文档的接口没写清楚怎么传评价，所以只实现了动态渲染数据、上传图片，但是无法发送评论）')\r\n  },\r\n  data () {\r\n    return {\r\n      rateNum: 0, // 商品评分\r\n      message: '', // 商品评价\r\n      fileList: [], // 图片文件上传列表\r\n      uploadFileInfo: [] // 成功上传后的图片信息对象列表\r\n    }\r\n  },\r\n  methods: {\r\n    // 文件上传完毕后会触发 after-read 回调函数，获取到对应的 file 对象。\r\n    async afterRead (file, detail) {\r\n      // 此时可以自行将文件上传至服务器\r\n      // console.log(file)\r\n      // console.log(detail)\r\n      // 传递file对象进去\r\n      const resp = await uploadImage(file.file)\r\n      console.log(resp)\r\n      // 将上传图片成功后返回的数据添加到数组中存储\r\n      this.uploadFileInfo.push(resp.data.fileInfo)\r\n    },\r\n    // 文件删除前操作，比如向服务器发出删除图片的请求，不过后端没有这个接口.....\r\n    beforeDelete (file, detail) {\r\n      console.log(file)\r\n      // 返回true才能使得v-model同时删除数据\r\n      return true\r\n    },\r\n    // 提交评价\r\n    async handlerSubmitComment () {\r\n      const resp = await submitComment(this.detailGoods.order_id, [{\r\n        goods_id: this.goods_id,\r\n        order_goods_id: this.order_goods_id,\r\n        score: this.rateNum * 2,\r\n        content: this.message,\r\n        imageList: [\r\n          {}, // api文档一点解释都没有写，完全不知道传什么对象....草！！！！\r\n          {}\r\n        ],\r\n        // imageList: this.uploadFileInfo, // 整个上传返回的info的数组？？？妈的了吧...api文档真的是一点东西都不写...\r\n        uploaded: [\r\n          '10307',\r\n          '10308'\r\n        ]\r\n        // uploaded: this.uploadFileInfo.map(item => item.uploader_id + '') // 我猜测应该是图片上传后的ID？？？\r\n      }])\r\n      console.log(resp, '评价')\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters('comment', ['commentGoods']),\r\n    order_goods_id () {\r\n      return +this.$route.query.order_goods_id\r\n    },\r\n    goods_id () {\r\n      return +this.$route.query.goods_id\r\n    },\r\n    detailGoods () {\r\n      return this.commentGoods.goods.find(item => item.order_goods_id === +this.order_goods_id && item.goods_id === this.goods_id)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.goods-img {\r\n  width: 90px;\r\n  height: 90px;\r\n  margin: 0px 10px 10px 0;\r\n  img {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n}\r\n.goods-content {\r\n  flex: 2;\r\n}\r\n.goods-info {\r\n  display: flex;\r\n}\r\n.main {\r\n  padding: 0 10px;\r\n}\r\n.rate {\r\n  padding-left: 10px;\r\n}\r\n.van-cell {\r\n  padding-left: 10px;\r\n  padding-right: 10px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./product-comment-detail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./product-comment-detail.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./product-comment-detail.vue?vue&type=template&id=0c6e8ed4&scoped=true&\"\nimport script from \"./product-comment-detail.vue?vue&type=script&lang=js&\"\nexport * from \"./product-comment-detail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./product-comment-detail.vue?vue&type=style&index=0&id=0c6e8ed4&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0c6e8ed4\",\n  null\n  \n)\n\nexport default component.exports","// 商品相关api\r\n\r\nimport request from '@/utils/request'\r\n\r\nexport const getProductDetail = (goodsId) => {\r\n  return request.get('/goods/detail', {\r\n    params: {\r\n      goodsId\r\n    }\r\n  })\r\n}\r\n\r\n// 获取商品评价\r\nexport const getProComments = (goodsId, scoreType, page) => {\r\n  return request.get('/comment/list', {\r\n    params: {\r\n      goodsId,\r\n      scoreType,\r\n      page\r\n    }\r\n  })\r\n}\r\n\r\n// 获取评价总数\r\nexport const getProCommentsCount = (goodsId) => {\r\n  return request.get('/comment/total', {\r\n    params: {\r\n      goodsId\r\n    }\r\n  })\r\n}\r\n\r\n// 商品评价\r\nexport const submitComment = (orderId, objArr) => {\r\n  return request.post('/order.comment/submit', {\r\n    orderId,\r\n    form: objArr\r\n  })\r\n}\r\n\r\n// 上传评价图片\r\nexport const uploadImage = (fileObj) => {\r\n  const fromData = new FormData()\r\n  fromData.append('file', fileObj)\r\n  return request.post('/upload/image', fromData, {\r\n    headers: {\r\n      'Content-Type': 'multipart/form-data'\r\n    }\r\n  })\r\n}\r\n"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","back","detailGoods","goods_image","_v","_s","goods_name","model","value","rateNum","callback","$$v","expression","maxHeight","minHeight","message","afterRead","beforeDelete","fileList","handlerSubmitComment","staticRenderFns","name","created","_Notify","data","uploadFileInfo","methods","file","detail","resp","uploadImage","console","log","push","fileInfo","submitComment","order_id","goods_id","order_goods_id","score","content","imageList","uploaded","computed","mapGetters","$route","query","commentGoods","goods","find","item","component","getProductDetail","goodsId","request","get","params","getProComments","scoreType","page","getProCommentsCount","orderId","objArr","post","form","fileObj","fromData","FormData","append","headers"],"sourceRoot":""}